<template>
  <el-scrollbar style="height: 100%">
    <div>
      <div>
        <el-button @click="showVideoCol">Êü•ÁúãVideoCol</el-button>
        <el-button @click="showVideoDetails">Êü•ÁúãvideoDetails</el-button>
        <el-button @click="refreshVc">Âà∑Êñ∞Êï∞ÊçÆÂ∫ì</el-button>
      </div>
      <div>
        <el-pagination
          background
          layout="total, prev, pager, next, jumper"
          :current-page="currentPage"
          :page-size="pageSize"
          :total="totalSize"
          @current-change="handleCurrentChange"
        ></el-pagination>
      </div>
      <el-row :gutter="5">
        <el-col v-for="(item, id) in videoInfo" :key="id" :span="6">
          <el-card :body-style="{ padding: '0px' }" shadow="always" class="videoCard">
            <figure class="imghvr-shutter-out-diag-1 videoFigure" @contextmenu="rtClickOpenMenu(item.video_id)">
              <img class="videoCover" :src="videoInfo[id].video_cover" />

              <figcaption class="videoFigcaption">
                <img src="@/assets/pic/videoNew.png" class="figcaption-img" @click="openFile(item.video_path)" />
              </figcaption>
            </figure>

            <div
              style="
                text-align: center;
                font-size: 13px;
                margin-top: 8px;
                margin-bottom: 1px;
                margin-left: 8px;
                margin-right: 8px;
              "
            >
              <el-tooltip class="item" effect="dark" :content="videoInfo[id].video_name" placement="top">
                <div id="title">
                  <div style="cursor: pointer" @click="$router.push('/jile/video-player?video_id=' + item.video_id)">
                    <strong>{{ videoInfo[id].video_name }}</strong>
                  </div>
                </div>
              </el-tooltip>
              <!-- <el-rate v-model="videoInfo[id].video_score" disabled></el-rate> -->
            </div>

            <div style="margin-top: 5px; margin-bottom: 5px; margin-left: 5px; margin-right: 5px">
              <div style="display: inline">{{ starRateIcon[item.video_score] }}</div>
              <el-divider direction="vertical" />
              <el-link @click="openDialogForm(item)">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#yw-icon-edit"></use>
                </svg>
              </el-link>
              <el-link @click="openFolder(item.video_path)">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#yw-icon-folder-close"></use>
                </svg>
              </el-link>
              <el-link @click="deleteFile(item.video_id)">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#yw-icon-ashbin"></use>
                </svg>
              </el-link>
              <el-link @click="openVideoInfoDialog(item.video_id)">
                <svg class="icon" aria-hidden="true">
                  <use xlink:href="#yw-icon-attachment"></use>
                </svg>
              </el-link>

              <div style="float: right">
                <el-checkbox v-model="checkedList[id]"></el-checkbox>
              </div>
            </div>
          </el-card>
        </el-col>
      </el-row>
    </div>

    <div id="dialog">
      <el-dialog v-model="dialogFormVisible" title="‰øÆÊîπËµÑÊ∫êÂêçÁß∞">
        <el-form :model="reNameForm">
          <el-form-item label="ÂéüÂêçÁß∞" :label-width="formLabelWidth">
            <div>{{ reNameForm.oldName }}</div>
          </el-form-item>
          <el-form-item label="Êñ∞ÂêçÁß∞" :label-width="formLabelWidth">
            <el-input v-model="reNameForm.newName" autocomplete="off">
              <template #append>{{ reNameForm.suffix }}</template>
            </el-input>
          </el-form-item>
        </el-form>
        <template #footer>
          <div class="dialog-footer">
            <el-button @click="dialogFormVisible = false">Âèñ Ê∂à</el-button>
            <el-button type="primary" @click="editFileName">Á°Æ ÂÆö</el-button>
          </div>
        </template>
      </el-dialog>
    </div>

    <el-dialog v-model="videoEditVisible" title="üéûÔ∏è ÁºñËæëËßÜÈ¢ë‰ø°ÊÅØ" width="60%">
      <el-scrollbar max-height="60vh">
        <el-row>
          <el-col :span="6">
            <el-image :src="videoDetails.videoCover" style="aspect-ratio: 57/84; margin: 5px" fit="cover" />
            <div style="width: 100%; text-align: center">
              <el-link target="_blank" @click="selectCoverInDetails">Êõ¥Êñ∞Â∞ÅÈù¢Âõæ/Êµ∑Êä•</el-link>
            </div>
            <div style="width: 100%; text-align: center">
              <el-button
                v-if="videoDetails.followed == 0"
                type="danger"
                style="width: 80%; margin-top: 10px; text-align: center"
                @click="videoDetails.followed = 1"
              >
                {{ showFollowed }}
              </el-button>
              <el-button
                v-if="videoDetails.followed == 1"
                type="info"
                style="width: 80%; margin-top: 10px; text-align: center"
                @mouseenter="showNotFollowed = 'ÂèñÊ∂àÊî∂Ëóè'"
                @mouseleave="showNotFollowed = 'Â∑≤Êî∂Ëóè'"
                @click="videoDetails.followed = 0"
              >
                {{ showNotFollowed }}
              </el-button>
            </div>
          </el-col>
          <el-col :span="18">
            <el-form :model="videoDetails" :rules="rules">
              <el-form-item label="ËßÜÈ¢ëÂêçÁß∞" :label-width="formLabelWidth">
                <div>{{ videoDetails.videoName }}</div>
              </el-form-item>
              <el-form-item label="ËØÑÂàÜ" :label-width="formLabelWidth">
                <el-rate
                  v-model="videoDetails.videoScore"
                  :texts="['ÂæàÂ∑Æ', 'ËæÉÂ∑Æ', 'ËøòË°å', 'Êé®Ëçê', 'ÂäõËçê']"
                  show-text
                ></el-rate>
              </el-form-item>
              <el-form-item label="Ê†áÁ≠æ" :label-width="formLabelWidth">
                <el-row>
                  <el-tag
                    v-for="tag in videoDetails.tags"
                    :key="tag.id"
                    style="margin-right: 10px; margin-bottom: 10px"
                    size="large"
                    closable
                    :disable-transitions="false"
                    type="success"
                    :hit="true"
                    @close="handleTagClose(videoDetails.videoID, tag)"
                  >
                    {{ tag.tag_name }}
                  </el-tag>
                  <el-col :span="9">
                    <el-input
                      v-model="inputValue"
                      size="small"
                      placeholder="ËØ∑ËæìÂÖ•Ê†áÁ≠æ"
                      @keyup.enter="handleInputConfirm"
                      @blur="handleInputConfirm"
                    />
                  </el-col>
                </el-row>
              </el-form-item>
              <el-form-item label="‰∏äÊò†Êó•Êúü" :label-width="formLabelWidth">
                <el-date-picker
                  v-model="videoDetails.releaseDate"
                  type="date"
                  placeholder="ÈÄâÊã©‰∏äÊò†Êó•Êúü"
                  size="default"
                />
              </el-form-item>
              <el-form-item label="Áõ∏ÂÖ≥ÁΩëÂùÄ" :label-width="formLabelWidth" prop="url">
                <el-input v-model="videoDetails.url" placeholder="ËØ∑ËæìÂÖ•Áõ∏ÂÖ≥ÁΩëÂùÄ" size="default"></el-input>
              </el-form-item>
              <el-form-item label="ÂØºÊºî" :label-width="formLabelWidth">
                <el-row>
                  <el-tag
                    v-for="director in videoDetails.directorList.list"
                    :key="director.id"
                    style="margin-right: 10px; margin-bottom: 10px"
                    size="large"
                    closable
                    :disable-transitions="false"
                    effect="dark"
                    type="danger"
                    @close="handleDirectorClose(videoDetails.videoID, director)"
                  >
                    {{ director.name }}
                  </el-tag>
                  <el-col :span="9">
                    <el-input
                      v-model="inputDirectorValue"
                      size="small"
                      placeholder="ËØ∑ËæìÂÖ•ÂØºÊºîÂêçÁß∞"
                      @keyup.enter="handleDirectorConfirm"
                      @blur="handleDirectorConfirm"
                    />
                  </el-col>
                </el-row>
              </el-form-item>

              <el-form-item label="ÁºñÂâß/‰ΩúËÄÖ" :label-width="formLabelWidth">
                <el-row>
                  <el-tag
                    v-for="author in videoDetails.authorList.list"
                    :key="author.id"
                    style="margin-right: 10px; margin-bottom: 10px"
                    size="large"
                    closable
                    :disable-transitions="false"
                    effect="dark"
                    type="warning"
                    @close="handleAuthorClose(videoDetails.videoID, author)"
                  >
                    {{ author.name }}
                  </el-tag>
                  <el-col :span="9">
                    <el-input
                      v-model="inputAuthorValue"
                      size="small"
                      placeholder="ËØ∑ËæìÂÖ•ÁºñÂâß/‰ΩúËÄÖÂêçÁß∞"
                      @keyup.enter="handleAuthorConfirm"
                      @blur="handleAuthorConfirm"
                    />
                  </el-col>
                </el-row>
              </el-form-item>

              <el-form-item label="ÊºîÂëò" :label-width="formLabelWidth">
                <el-row>
                  <el-tag
                    v-for="actor in videoDetails.actorList.list"
                    :key="actor.id"
                    style="margin-right: 10px; margin-bottom: 10px"
                    size="large"
                    closable
                    :disable-transitions="false"
                    effect="dark"
                    type="success"
                    @close="handleActorClose(videoDetails.videoID, actor)"
                  >
                    {{ actor.name }}
                  </el-tag>
                  <el-col :span="9">
                    <el-input
                      v-model="inputActorValue"
                      size="small"
                      placeholder="ËØ∑ËæìÂÖ•ÊºîÂëòÂêçÁß∞"
                      @keyup.enter="handleActorConfirm"
                      @blur="handleActorConfirm"
                    />
                  </el-col>
                </el-row>
              </el-form-item>

              <el-form-item label="ÂÖ∂‰ªñ‰∫∫Âëò" :label-width="formLabelWidth">
                <el-row>
                  <el-tag
                    v-for="other in videoDetails.otherList.list"
                    :key="other.id"
                    style="margin-right: 10px; margin-bottom: 10px"
                    size="large"
                    closable
                    :disable-transitions="false"
                    effect="dark"
                    type="info"
                    @close="handleOtherClose(videoDetails.videoID, other)"
                  >
                    {{ other.name }}
                  </el-tag>
                  <el-col :span="9">
                    <el-input
                      v-model="inputOtherValue"
                      size="small"
                      placeholder="ËØ∑ËæìÂÖ•ÂÖ∂‰ªñ‰∫∫ÂëòÂêçÁß∞"
                      @keyup.enter="handleOtherConfirm"
                      @blur="handleOtherConfirm"
                    />
                  </el-col>
                </el-row>
              </el-form-item>

              <el-form-item label="ÁÆÄ‰ªã" :label-width="formLabelWidth">
                <el-input
                  v-model="videoDetails.intro"
                  :autosize="{ minRows: 3, maxRows: 9 }"
                  maxlength="350"
                  placeholder="Please input"
                  show-word-limit
                  type="textarea"
                />
              </el-form-item>
            </el-form>
          </el-col>
        </el-row>
      </el-scrollbar>
      <template #footer>
        <div class="dialog-footer">
          <el-button type="primary" @click="showDetailsConfirm">Á°Æ ËÆ§</el-button>

          <el-button @click="videoEditVisible = false">Âèñ Ê∂à</el-button>
        </div>
      </template>
    </el-dialog>
  </el-scrollbar>
</template>

<script >
import 'imagehover.css/scss/imagehover.scss'
import { ElMessage } from 'element-plus'

const { shell } = require('electron')
const fs = require('fs-extra')
const remote = require('@electron/remote')
const { Menu, dialog } = remote
import { mapState, mapActions } from 'vuex'
import SvgIcon from '@/icons/SvgIcon.vue'

export default {
  components: { SvgIcon },
  inject: ['refresh'],
  data() {
    return {
      starRateIcon: ['üëª', 'ü§°', 'üò•', 'üòë', 'ü•∞', 'üòç'],
      showFollowed: '‚ù§ Êî∂Ëóè',
      showNotFollowed: 'Â∑≤Êî∂Ëóè',
      inputValue: '',
      inputDirectorValue: '',
      inputAuthorValue: '',
      inputActorValue: '',
      inputOtherValue: '',
      dialogFormVisible: false,
      videoEditVisible: false,
      vc_id: 1,
      currentPage: 1,
      pageSize: 12,
      totalSize: 0,
      fit: 'cover',
      rules: {
        url: [
          {
            pattern: /^((http|https):\/\/)?(([A-Za-z0-9]+-[A-Za-z0-9]+|[A-Za-z0-9]+)\.)+([A-Za-z]+)[/?:]?.*$/,
            message: 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆURLÊ†ºÂºè',
            trigger: 'blur'
          }
        ]
      },
      defaultCover: 'src/icons/my-icon/video-o.svg',
      videoCol: {
        vc_name: '',
        vc_path: '',
        vc_desc: '',
        id: ''
      },
      videoInfo: [
        {
          video_id: 0,
          video_name: '',
          video_path: '',
          video_cover: '',
          video_tag: [],
          video_score: 0
        }
      ],
      checkedList: [],
      reNameForm: {
        videoID: 0,
        videoPath: '',
        oldName: '',
        newName: '',
        suffix: ''
      },
      videoDetails: {
        vc_id: 0,
        videoID: 0,
        videoName: '',
        videoCover: '',
        videoScore: 0,
        intro: '',
        followed: 0,
        releaseDate: '',
        url: '',
        tags: [
          {
            id: 0,
            tag_name: ''
          }
        ],
        directorList: {
          roleID: 1,
          roleName: 'ÂØºÊºî',
          list: [
            {
              id: 0,
              name: '',
              profile: '',
              birthday: '',
              followed: 0
            }
          ]
        },
        authorList: {
          roleID: 2,
          roleName: 'ÁºñÂâß',
          list: [
            {
              id: 0,
              name: '',
              profile: '',
              birthday: '',
              followed: 0
            }
          ]
        },
        actorList: {
          roleID: 3,
          roleName: 'ÊºîÂëò',
          list: [
            {
              id: 0,
              name: '',
              profile: '',
              birthday: '',
              followed: 0
            }
          ]
        },
        otherList: {
          roleID: 4,
          roleName: 'ÂÖ∂‰ªñ',
          list: [
            {
              id: 0,
              name: '',
              profile: '',
              birthday: '',
              followed: 0
            }
          ]
        }
      },
      coverSavePath: 'I:\\JiLeFile\\video\\cover',
      formLabelWidth: '80px',
      contextMenuTemplate: [],
      filtersList: {
        imageFilters: [{ name: 'Images', extensions: ['jpg', 'png', 'gif'] }]
      }
    }
  },
  created() {
    this.getFileList(this.vc_id, this.currentPage, this.pageSize)
  },
  methods: {
    ...mapActions('video-col', [
      'getFirstVC',
      'refreshVcData',
      'videoRename',
      'videoDelete',
      'editVideoCover',
      'autoGetCover',
      'getVideoDetails',
      'updateVideoDetails',
      'getVideoCol'
    ]),
    getFileList(vc_id, page, pageSize) {
      let pageInfo = {
        vc_id: vc_id,
        page: page,
        pageSize: pageSize
      }
      //ÈáçÁΩÆË°®Âçï‰ø°ÊÅØ

      this.videoInfo = this.$options.data().videoInfo
      this.getVideoCol(pageInfo).then((response) => {
        // console.log(response.data)
        this.videoCol = response.data
        // console.log(this.videoCol)

        //Ê≥®ÊÑèËøôÈáå‰ΩøÁî®SyncÂêåÊ≠•ÊñπÊ≥ïÊâçËÉΩËé∑ÂèñÂà∞ËøîÂõûÁöÑÊñá‰ª∂ÂÄº
        //‰ΩøÁî®ÂºÇÊ≠•ÊñπÊ≥ïÔºàreaddirÔºâÁî±‰∫é‰∏çËÉΩÁ°ÆÂÆöÁªìÊûúËøîÂõûÊó∂Èó¥ÔºåÊâÄ‰ª•Êó†Ê≥ïÂú®Â§ñÈÉ®ÂæóÂà∞Êñá‰ª∂ÂàóË°®ÔºåÂè™ËÉΩËøõË°åÂÜÖÈÉ®Â§ÑÁêÜ
        // this.fileList = fs.readdirSync(this.videoCol.vc_path)

        // for (var i = 0; i < this.fileList.length; i++) {
        //   // console.log(this.videoInfo[i])
        //   this.videoInfo[i]={
        //     video_name: this.fileList[i],
        //     video_path: this.videoCol.vc_path + '\\' + this.fileList[i],
        //     video_cover: this.defaultCover
        //   }
        // }

        var fileList = response.data.vc_info.list
        //Ëé∑ÂèñËØ¶ÁªÜÂΩ±ËßÜÊñá‰ª∂‰ø°ÊÅØÂàóË°®
        for (var i = 0; i < fileList.length; i++) {
          // console.log(fileList)
          var videoCover = ''
          if (fileList[i].videoCover == null || fileList[i].videoCover == '') {
            videoCover = this.defaultCover
          } else {
            videoCover = fileList[i].videoCover
          }
          this.videoInfo[i] = {
            video_id: fileList[i].videoID,
            video_name: fileList[i].videoName,
            video_path: this.videoCol.vc_path + '\\' + fileList[i].videoName,
            video_cover: videoCover,
            video_score: fileList[i].videoScore,
            video_tag: fileList[i].videoTag
          }
        }
        //ÈÖçÁΩÆÂàÜÈ°µ‰ø°ÊÅØ
        this.pageSize = response.data.vc_info.pageSize
        this.currentPage = response.data.vc_info.pageNum
        this.totalSize = response.data.vc_info.total
      })
    },
    handleCurrentChange(val) {
      this.getFileList(this.vc_id, val, this.pageSize)
    },
    selectCover(item) {
      var id = item.id
      console.log(id)
      //Âà©Áî®ElectronÁöÑDialogÊâìÂºÄÊñá‰ª∂ÈÄâÊã©Âô®ÊàñÊñá‰ª∂Â§πÈÄâÊã©Âô®Âπ∂ËøõË°åÁâπÊÆäËÆæÁΩÆ
      dialog
        .showOpenDialog({
          title: 'ËØ∑ÈÄâÊã©ËßÜÈ¢ëÂ∞ÅÈù¢',
          properties: ['openFile'],
          filters: this.filtersList.imageFilters
        })
        .then((result) => {
          if (!result || result.filePaths.length == 0) return //‰∏∫Á©∫ÊÉÖÂÜµ‰∏ãË°®Á§∫Êú™ÈÄâÊã©Êñá‰ª∂ÔºåÁõ¥Êé•returnÁªìÊùüÂáΩÊï∞
          var data = {
            videoID: id,
            coverPath: result.filePaths[0]
          }
          console.log(data)
          this.editVideoCover(data).then((response) => {
            this.refresh()
          })
        })
        .catch((err) => {
          console.log(err)
        })
    },
    deleteCover(item) {
      var id = item.id
      console.log(id)
      // this.videoInfo[id].video_cover = this.defaultCover
      //Â∞ÜËßÜÈ¢ëÂ∞ÅÈù¢ÂõæËÆæ‰∏∫ÈªòËÆ§Âõæ
      var data = {
        videoID: id,
        coverPath: this.defaultCover
      }
      this.editVideoCover(data).then((response) => {
        this.refresh()
      })
    },
    initMenuTemplate(id) {
      this.contextMenuTemplate = [
        { label: 'ÈÄâÊã©Â∞ÅÈù¢Âõæ', click: this.selectCover, id: id },
        { label: 'Ëá™Âä®ÁîüÊàêÂ∞ÅÈù¢Âõæ', click: this.autoCover, id: id },
        { label: 'Âà†Èô§Â∞ÅÈù¢Âõæ', click: this.deleteCover, id: id },
        { type: 'separator' }
      ]
    },
    openFile(path) {
      shell.openPath(path)
    },
    openFolder(path) {
      shell.showItemInFolder(path)
    },
    showVideoCol() {
      console.log(this.videoCol)
    },
    autoCover(item) {
      var videoID = item.id
      this.autoGetCover({ videoID }).then((response) => {
        this.refresh()
      })
    },
    deleteFile(videoID) {
      //shell.trashItem(path)
      this.$confirm('Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§ËØ•Êñá‰ª∂ÔºàÂåÖÊã¨Êú¨Âú∞Êñá‰ª∂Ôºâ, ÊòØÂê¶Á°ÆÂÆö?', 'ÊèêÁ§∫', {
        confirmButtonText: 'Á°ÆÂÆö',
        cancelButtonText: 'ÂèñÊ∂à',
        type: 'warning'
      })
        .then(() => {
          // shell.trashItem(path)
          this.videoDelete({ videoID }).then((response) => {
            this.refresh()
          })
        })
        .catch(() => {
          this.$message({
            type: 'info',
            message: 'Â∑≤ÂèñÊ∂àÂà†Èô§'
          })
        })
    },
    openDialogForm(video) {
      this.reNameForm.videoID = video.video_id
      this.reNameForm.oldName = video.video_name
      this.reNameForm.videoPath = video.video_path
      //Ëé∑ÂèñÊñá‰ª∂ÂêéÁºÄ
      this.reNameForm.suffix = video.video_name.substring(video.video_name.lastIndexOf('.'))
      this.dialogFormVisible = true
    },
    openVideoInfoDialog(videoID) {
      //ÈáçÁΩÆË°®Âçï‰ø°ÊÅØ
      this.videoDetails = this.$options.data().videoDetails
      this.inputValue = ''
      this.getVideoDetails({ videoID }).then((response) => {
        //Â§ÑÁêÜÂàùÂßãË°®Âçï
        this.videoDetails.vc_id = response.data.vc_id
        this.videoDetails.videoID = response.data.videoID
        this.videoDetails.videoName = response.data.videoName
        this.videoDetails.videoCover = response.data.videoCover
        this.videoDetails.videoScore = response.data.videoScore
        this.videoDetails.intro = response.data.intro
        this.videoDetails.followed = response.data.followed
        this.videoDetails.releaseDate = response.data.releaseDate
        this.videoDetails.tags = response.data.tags
        this.videoDetails.url = response.data.url

        var pList = response.data.personList
        var directors = []
        var authors = []
        var actors = []
        var others = []
        // console.log(this.videoDetails.tags)
        //Â§ÑÁêÜËßíËâ≤Ë°®ÂçïÊï∞ÊçÆ
        for (var i = 0; i < pList.length; i++) {
          console.log(pList[i])
          var person = pList[i]
          if (person.roleID == 1) {
            directors.push(person)
          } else if (person.roleID == 2) {
            authors.push(person)
          } else if (person.roleID == 3) {
            actors.push(person)
          } else if (person.roleID == 4) {
            others.push(person)
          }
        }
        this.videoDetails.directorList.list = directors
        this.videoDetails.actorList.list = actors
        this.videoDetails.authorList.list = authors
        this.videoDetails.otherList.list = others
      })
      this.videoEditVisible = true
    },
    editFileName() {
      this.dialogFormVisible = false //ÂÖ≥Èó≠dialogÈ°µÈù¢
      var form = this.reNameForm
      var data = {
        newName: form.newName + form.suffix,
        videoID: form.videoID
      }
      this.videoRename(data).then((response) => {
        var code = response.code
        if (code != 20000) {
          // console.log(response.message)
          ElMessage.error(response.message)
        } else {
          this.refresh()
        }
      })
      //ÈáçÁΩÆË°®Âçï‰ø°ÊÅØ
      this.reNameForm = this.$options.data().reNameForm
    },
    rtClickOpenMenu(id) {
      this.initMenuTemplate(id)
      //ÂàõÂª∫ËèúÂçïÈ°π
      this.menu = Menu.buildFromTemplate(this.contextMenuTemplate)
      this.menu.popup({ window: remote.getCurrentWindow() })
    },
    refreshVc() {
      var vcID = this.videoCol.id
      this.refreshVcData({ vcID }).then((response) => {
        //ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢--‰ΩøÁî®provideÂíåinject ÊôÆÈÄöÂà∑Êñ∞ ‰∏ç‰ºö‰ΩøÈ°µÈù¢Âá∫Áé∞Áü≠ÊöÇÁöÑÁ©∫ÁôΩÔºå‰ΩìÈ™åÊïàÊûúÊØîËæÉÂ•Ω
        // (vue5ÁßçÊñπÂºèÂÆûÁé∞È°µÈù¢"Âà∑Êñ∞") https://www.jianshu.com/p/b9b7eae48f45
        this.refresh()
      })
    },
    showReNameForm() {
      console.log(this.reNameForm)
    },
    showVideoDetails() {
      console.log(this.videoDetails)
    },
    handleTagClose(videoID, tag) {
      for (var i = 0; i < this.videoDetails.tags.length; i++) {
        if (this.videoDetails.tags[i].id == tag.id && this.videoDetails.tags[i].tag_name == tag.tag_name) {
          this.videoDetails.tags.splice(i, 1)
          break
        }
      }
    },
    handleDirectorClose(videoID, director) {
      for (var i = 0; i < this.videoDetails.directorList.list.length; i++) {
        if (
          this.videoDetails.directorList.list[i].id == director.id &&
          this.videoDetails.directorList.list[i].name == director.name
        ) {
          this.videoDetails.directorList.list.splice(i, 1)
          break
        }
      }
    },
    handleAuthorClose(videoID, author) {
      for (var i = 0; i < this.videoDetails.authorList.list.length; i++) {
        if (
          this.videoDetails.authorList.list[i].id == author.id &&
          this.videoDetails.authorList.list[i].name == author.name
        ) {
          this.videoDetails.authorList.list.splice(i, 1)
          break
        }
      }
    },
    handleActorClose(videoID, actor) {
      for (var i = 0; i < this.videoDetails.actorList.list.length; i++) {
        if (
          this.videoDetails.actorList.list[i].id == actor.id &&
          this.videoDetails.actorList.list[i].name == actor.name
        ) {
          this.videoDetails.actorList.list.splice(i, 1)
          break
        }
      }
    },
    handleOtherClose(videoID, other) {
      for (var i = 0; i < this.videoDetails.otherList.list.length; i++) {
        if (
          this.videoDetails.otherList.list[i].id == other.id &&
          this.videoDetails.otherList.list[i].name == other.name
        ) {
          this.videoDetails.otherList.list.splice(i, 1)
          break
        }
      }
    },
    handleInputConfirm() {
      if (this.inputValue) {
        var tag = {
          id: 0,
          tag_name: this.inputValue
        }
        //Á°ÆËÆ§‰∏çÂ≠òÂú®Áõ∏ÂêåÂÄºÁöÑÊÉÖÂÜµ‰∏ãÂÜçÂä†ÂÖ•
        var i = 0
        for (i = 0; i < this.videoDetails.tags.length; i++) {
          if (this.inputValue == this.videoDetails.tags[i].tag_name) {
            break
          }
        }
        if (i == this.videoDetails.tags.length) {
          this.videoDetails.tags.push(tag)
        }
      }
      this.inputValue = ''
    },
    handleDirectorConfirm() {
      if (this.inputDirectorValue) {
        var director = {
          id: 0,
          name: this.inputDirectorValue
        }
        var i = 0
        for (i = 0; i < this.videoDetails.directorList.list.length; i++) {
          if (this.inputDirectorValue == this.videoDetails.directorList.list[i].name) {
            break
          }
        }
        if (i == this.videoDetails.directorList.list.length) {
          this.videoDetails.directorList.list.push(director)
        }
      }
      this.inputDirectorValue = ''
    },

    handleAuthorConfirm() {
      if (this.inputAuthorValue) {
        var author = {
          id: 0,
          name: this.inputAuthorValue
        }
        var i = 0
        for (i = 0; i < this.videoDetails.authorList.list.length; i++) {
          if (this.inputAuthorValue == this.videoDetails.authorList.list[i].name) {
            break
          }
        }
        if (i == this.videoDetails.authorList.list.length) {
          this.videoDetails.authorList.list.push(author)
        }
      }
      this.inputAuthorValue = ''
    },
    handleActorConfirm() {
      if (this.inputActorValue) {
        var actor = {
          id: 0,
          name: this.inputActorValue
        }
        var i = 0
        for (i = 0; i < this.videoDetails.actorList.list.length; i++) {
          if (this.inputActorValue == this.videoDetails.actorList.list[i].name) {
            break
          }
        }
        if (i == this.videoDetails.actorList.list.length) {
          this.videoDetails.actorList.list.push(actor)
        }
      }
      this.inputActorValue = ''
    },
    handleOtherConfirm() {
      if (this.inputOtherValue) {
        var other = {
          id: 0,
          name: this.inputOtherValue
        }
        var i = 0
        for (i = 0; i < this.videoDetails.otherList.list.length; i++) {
          if (this.inputOtherValue == this.videoDetails.otherList.list[i].name) {
            break
          }
        }
        if (i == this.videoDetails.otherList.list.length) {
          this.videoDetails.otherList.list.push(other)
        }
      }
      this.inputOtherValue = ''
    },
    selectCoverInDetails() {
      //Âà©Áî®ElectronÁöÑDialogÊâìÂºÄÊñá‰ª∂ÈÄâÊã©Âô®ÊàñÊñá‰ª∂Â§πÈÄâÊã©Âô®Âπ∂ËøõË°åÁâπÊÆäËÆæÁΩÆ
      dialog
        .showOpenDialog({
          title: 'ËØ∑ÈÄâÊã©ËßÜÈ¢ëÂ∞ÅÈù¢ÊàñÊµ∑Êä•Âõæ',
          properties: ['openFile'],
          filters: this.filtersList.imageFilters
        })
        .then((result) => {
          if (!result || result.filePaths.length == 0) return //‰∏∫Á©∫ÊÉÖÂÜµ‰∏ãË°®Á§∫Êú™ÈÄâÊã©Êñá‰ª∂ÔºåÁõ¥Êé•returnÁªìÊùüÂáΩÊï∞

          this.videoDetails.videoCover = result.filePaths[0]
        })
        .catch((err) => {
          console.log(err)
        })
    },
    showDetailsConfirm() {
      // console.log(this.videoDetails)
      this.$confirm('ÊòØÂê¶Á°ÆÂÆö‰øùÂ≠ò‰øÆÊîπÂÜÖÂÆπ', 'ÊèêÁ§∫', {
        confirmButtonText: 'Á°ÆÂÆö',
        cancelButtonText: 'ÂèñÊ∂à',
        type: 'warning'
      })
        .then(() => {
          this.updateDetails()
        })
        .catch(() => {
          this.$message({
            type: 'info',
            message: 'Â∑≤ÂèñÊ∂à‰øùÂ≠ò'
          })
        })
    },
    updateDetails() {
      //Â§ÑÁêÜVideoDetailsÊï∞ÊçÆÔºå‰∏ªË¶ÅÊòØÂØπËßíËâ≤Êï∞ÊçÆËøõË°åÂêàÂπ∂
      var personList = []
      for (var i = 0; i < this.videoDetails.directorList.list.length; i++) {
        var person = new Object()
        person = this.videoDetails.directorList.list[i]
        person.roleID = this.videoDetails.directorList.roleID
        person.roleName = this.videoDetails.directorList.roleName
        personList.push(person)
      }
      for (var i = 0; i < this.videoDetails.authorList.list.length; i++) {
        var person = new Object()
        person = this.videoDetails.authorList.list[i]
        person.roleID = this.videoDetails.authorList.roleID
        person.roleName = this.videoDetails.authorList.roleName
        personList.push(person)
      }
      for (var i = 0; i < this.videoDetails.actorList.list.length; i++) {
        var person = new Object()
        person = this.videoDetails.actorList.list[i]
        person.roleID = this.videoDetails.actorList.roleID
        person.roleName = this.videoDetails.actorList.roleName
        personList.push(person)
      }
      for (var i = 0; i < this.videoDetails.otherList.list.length; i++) {
        var person = new Object()
        person = this.videoDetails.otherList.list[i]
        person.roleID = this.videoDetails.otherList.roleID
        person.roleName = this.videoDetails.otherList.roleName
        personList.push(person)
      }
      //ËøôÈáåÁî®JSON.parse(JSON.stringify());ÊñπÂºèËøõË°åÊ∑±Êã∑Ë¥ùÈÅøÂÖçÂà†Èô§Âá†‰∏™ËßíËâ≤ÂàóË°®ÂêéË°®ÂçïÊä•Èîô
      var details = JSON.parse(JSON.stringify(this.videoDetails))
      delete details.directorList
      delete details.actorList
      delete details.authorList
      delete details.otherList
      details.personList = personList
      this.updateVideoDetails(details).then((response) => {
        this.videoEditVisible = false
        this.refresh()
      })
    }
  }
}
</script>
<style lang="scss">
/* elementÊªöÂä®Êù°ÁªÑ‰ª∂ ÈöêËóèÊ∞¥Âπ≥ÊªöÂä®Êù° */
.sidebar-wrapper .el-scrollbar__wrap {
  overflow-x: hidden;
}
.is-horizontal {
  display: none;
}
.videoCover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.videoFigure {
  position: relative;
  width: 100%;
  height: 0;
  padding-top: 56.25%;
}

.videoFigcaption {
  position: relative;
  background-color: #0000008f !important;
}

.figcaption-img {
  cursor: pointer;
  width: 30%;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}

#title {
  width: 100%;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
  display: -webkit-box;
  overflow: hidden;
  text-overflow: ellipsis;
  word-break: break-all;
  //background-color: red($color: #cfcbcb);
  margin-bottom: 10px;
  margin-top: 10px;
}

.videoCard {
  border-bottom-left-radius: 15px;
  border-bottom-right-radius: 15px;
  margin: 5px;
  margin-bottom: 15px;
}
</style>